"use strict";(()=>{var e={};e.id=674,e.ids=[674],e.modules={3480:(e,r,t)=>{e.exports=t(5600)},3939:e=>{e.exports=require("@supabase/supabase-js")},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6435:(e,r)=>{Object.defineProperty(r,"M",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},8233:(e,r,t)=>{t.r(r),t.d(r,{config:()=>c,default:()=>l,routeModule:()=>d});var n={};t.r(n),t.d(n,{default:()=>u});var a=t(3480),s=t(8667),o=t(6435);let i=(0,t(3939).createClient)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.SUPABASE_SERVICE_ROLE_KEY);async function u(e,r){if("POST"!==e.method)return r.status(405).json({success:!1,error:"Method not allowed"});let{id:t}=e.query;if(!t)return r.status(400).json({success:!1,error:"Se requiere ID de estrategia"});let{operation_type:n,amount:a,description:s}=e.body;if(!n||!a)return r.status(400).json({success:!1,error:"Se requieren operation_type y amount"});let o=["deposit","withdrawal","adjustment"];if(!o.includes(n))return r.status(400).json({success:!1,error:`Tipo de operaci\xf3n no v\xe1lido. Debe ser uno de: ${o.join(", ")}`});try{let{data:e,error:o}=await i.from("betting_strategies").select("*").eq("id",t).single();if(o)throw o;if(!e)return r.status(404).json({success:!1,error:"Estrategia no encontrada"});let u=e.current_bankroll,l=parseFloat(a);if("deposit"===n)u+=l;else if("withdrawal"===n){if(e.current_bankroll<l)return r.status(400).json({success:!1,error:"No hay suficiente bankroll para realizar este retiro"});u-=l,l=-l}else"adjustment"===n&&(u+=l);let{error:c}=await i.from("betting_strategies").update({current_bankroll:u,updated_at:new Date().toISOString()}).eq("id",t);if(c)throw c;let{error:d}=await i.from("bankroll_history").insert({strategy_id:t,amount:u,previous_amount:e.current_bankroll,change_amount:l,change_percentage:l/e.current_bankroll*100,entry_type:n,description:s||`Operaci\xf3n manual: ${n}`});if(d)throw d;return r.status(200).json({success:!0,data:{operation_type:n,amount:l,previous_bankroll:e.current_bankroll,new_bankroll:u,change_percentage:l/e.current_bankroll*100}})}catch(e){return console.error(`Error en operaci\xf3n de bankroll: ${e.message}`),r.status(500).json({success:!1,error:e.message})}}let l=(0,o.M)(n,"default"),c=(0,o.M)(n,"config"),d=new a.PagesAPIRouteModule({definition:{kind:s.A.PAGES_API,page:"/api/strategies/[id]/bankroll-operation",pathname:"/api/strategies/[id]/bankroll-operation",bundlePath:"",filename:""},userland:n})},8667:(e,r)=>{Object.defineProperty(r,"A",{enumerable:!0,get:function(){return t}});var t=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})}};var r=require("../../../../webpack-api-runtime.js");r.C(e);var t=r(r.s=8233);module.exports=t})();