"use strict";(()=>{var e={};e.id=634,e.ids=[634],e.modules={1352:(e,t,a)=>{a.r(t),a.d(t,{config:()=>g,default:()=>d,routeModule:()=>_});var r={};a.r(r),a.d(r,{default:()=>l});var n=a(3480),o=a(8667),i=a(6435);let s=(0,a(3939).createClient)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.SUPABASE_SERVICE_ROLE_KEY);async function l(e,t){if("GET"!==e.method)return t.status(405).json({success:!1,error:"Method not allowed"});let{id:a}=e.query;if(!a)return t.status(400).json({success:!1,error:"Se requiere ID de estrategia"});try{let{data:e,error:r}=await s.from("betting_strategies").select("*").eq("id",a).single();if(r)throw r;if(!e)return t.status(404).json({success:!1,error:"Estrategia no encontrada"});let{data:n,error:o}=await s.from("strategy_stats").select("*").eq("strategy_id",a).single();if(o)throw o;let{data:i,error:l}=await s.from("bankroll_history").select("*").eq("strategy_id",a).order("created_at",{ascending:!0});if(l)throw l;let{data:u,error:d}=await s.from("strategy_selections").select("market_id, count(*)").eq("strategy_id",a).group("market_id");if(d)throw d;let{data:g,error:_}=await s.from("strategy_selections").select("bookmaker_id, count(*)").eq("strategy_id",a).group("bookmaker_id");if(_)throw _;let h={profit_loss_percentage:e.initial_bankroll>0?(e.current_bankroll-e.initial_bankroll)/e.initial_bankroll*100:0,average_stake:n.total_bets>0?n.total_staked/n.total_bets:0,hit_rate:n.total_bets>0?n.won_bets/n.total_bets*100:0,average_odds:n.total_bets>0?n.total_returns/n.total_staked:0,bankroll_history:i,market_distribution:u,bookmaker_distribution:g,evolution_data:i.map(e=>({date:e.created_at,bankroll:e.amount,change:e.change_amount}))},f={daily_roi:c(i,"day"),weekly_roi:c(i,"week"),monthly_roi:c(i,"month"),volatility:function(e){if(!e||e.length<3)return 0;let t=e.slice(1).map(e=>e.change_percentage||0),a=t.reduce((e,t)=>e+t,0)/t.length;return Math.sqrt(t.map(e=>Math.pow(e-a,2)).reduce((e,t)=>e+t,0)/t.length)}(i),sharpe_ratio:function(e){if(!e||e.length<3)return 0;let t=e.slice(1).map(e=>e.change_percentage/100||0),a=t.reduce((e,t)=>e+t,0)/t.length,r=Math.sqrt(t.map(e=>Math.pow(e-a,2)).reduce((e,t)=>e+t,0)/t.length);return 0===r?0:(a-.02/365)/r}(i),best_day:function(e,t){if(!e||e.length<2)return{date:null,change:0,percentage:0};let a={};return e.slice(1).forEach(e=>{let t;let r=new Date(e.created_at);t=r.toISOString().split("T")[0];a[t]||(a[t]={date:t,change:0,percentage:0,initial:e.previous_amount}),a[t].change+=e.change_amount,a[t].final=e.amount}),Object.keys(a).forEach(e=>{let t=a[e];t.percentage=t.change/t.initial*100}),Object.values(a).sort((e,t)=>t.percentage-e.percentage)[0]||{date:null,change:0,percentage:0}}(i,"day"),worst_day:function(e,t){if(!e||e.length<2)return{date:null,change:0,percentage:0};let a={};return e.slice(1).forEach(e=>{let t;let r=new Date(e.created_at);t=r.toISOString().split("T")[0];a[t]||(a[t]={date:t,change:0,percentage:0,initial:e.previous_amount}),a[t].change+=e.change_amount,a[t].final=e.amount}),Object.keys(a).forEach(e=>{let t=a[e];t.percentage=t.change/t.initial*100}),Object.values(a).sort((e,t)=>e.percentage-t.percentage)[0]||{date:null,change:0,percentage:0}}(i,"day")};return t.status(200).json({success:!0,data:{strategy:e,stats:n,additional_stats:h,performance_metrics:f}})}catch(e){return console.error("Error al obtener estad\xedsticas:",e),t.status(500).json({success:!1,error:e.message})}}function c(e,t){let a;if(!e||e.length<2)return 0;let r=new Date;"day"===t?a=new Date(r.setDate(r.getDate()-1)):"week"===t?a=new Date(r.setDate(r.getDate()-7)):"month"===t&&(a=new Date(r.setMonth(r.getMonth()-1)));let n=e.filter(e=>new Date(e.created_at)>=a);if(n.length<2)return 0;let o=n[0].amount;return(n[n.length-1].amount-o)/o*100}function u(e){let t=new Date(e.getFullYear(),0,1);return Math.ceil(((e-t)/864e5+t.getDay()+1)/7)}let d=(0,i.M)(r,"default"),g=(0,i.M)(r,"config"),_=new n.PagesAPIRouteModule({definition:{kind:o.A.PAGES_API,page:"/api/strategies/[id]/stats",pathname:"/api/strategies/[id]/stats",bundlePath:"",filename:""},userland:r})},3480:(e,t,a)=>{e.exports=a(5600)},3939:e=>{e.exports=require("@supabase/supabase-js")},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6435:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,a){return a in t?t[a]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,a)):"function"==typeof t&&"default"===a?t:void 0}}})},8667:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return a}});var a=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})}};var t=require("../../../../webpack-api-runtime.js");t.C(e);var a=t(t.s=1352);module.exports=a})();