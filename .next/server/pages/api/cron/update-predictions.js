"use strict";(()=>{var e={};e.id=484,e.ids=[484],e.modules={3480:(e,t,r)=>{e.exports=r(5600)},3939:e=>{e.exports=require("@supabase/supabase-js")},5035:e=>{e.exports=import("node-fetch")},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6435:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},6556:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.d(t,{At:()=>s,ZN:()=>u,bE:()=>p,iL:()=>c,wK:()=>d});var i=r(5035),n=e([i]);async function o(e,t={}){let r=`https://api.sportmonks.com/v3/football/${e}`,a=Object.keys(t).map(e=>`${encodeURIComponent(e)}=${encodeURIComponent(t[e])}`).join("&"),n=a?`${r}?${a}`:r;try{let e=await (0,i.default)(n,{headers:{Authorization:"OFni7bARihvquALzUS9p2PqhZHgy2t2DWHjgFperwEwxwxSm5DD5doL1gXEj"}});if(!e.ok)throw Error(`Error en la respuesta de la API: ${e.status} ${e.statusText}`);return await e.json()}catch(t){throw console.error(`Error al obtener datos de ${e}:`,t),t}}function s(e,t){return o(`fixtures/between/${e}/${t}`)}function c(e){return o(`fixtures/${e}`,{include:"predictions"})}function d(e){return o(`fixtures/${e}`,{include:"odds"})}function u(e=1){return o("teams",{page:e})}function p(e=1){return o("leagues",{include:"country",page:e})}i=(n.then?(await n)():n)[0],a()}catch(e){a(e)}})},7e3:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{default:()=>p});var i=r(3939),n=r(6556),o=r(9485),s=e([n]);n=(s.then?(await s)():s)[0];let l=(0,i.createClient)("https://nxhvjyfvdirhplgfpdkm.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im54aHZqeWZ2ZGlyaHBsZ2ZwZGttIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc0MDkzNzI1OCwiZXhwIjoyMDU2NTEzMjU4fQ.tflcdU-SgN-ODFXuimdEfAdvDDlvMoRNCqWZirYCj9Y");async function c(e=20){let t=new Date,r=Math.floor(t.getTime()/1e3),{data:a,error:i}=await l.from("fixtures").select("id, name").gt("starting_at_timestamp",r).eq("state_id",1).order("starting_at_timestamp",{ascending:!0}).limit(e);if(i)throw Error(`Error al obtener fixtures: ${i.message}`);return a||[]}async function d(e,t){if(!t||!t.data||!t.data.predictions)return 0;let r=t.data.predictions.map(t=>({id:t.id,fixture_id:e,type_id:t.type_id,predictions_json:JSON.stringify(t.predictions)}));if(0===r.length)return 0;let{error:a}=await l.from("predictions").upsert(r,{onConflict:"id"});if(a)throw Error(`Error al almacenar predicciones: ${a.message}`);return r.length}async function u(e,t,r,a=0,i=null){try{await l.from("update_logs").insert({entity_type:e,operation_type:t,status:r,records_affected:a,error_message:i,created_at:new Date().toISOString()})}catch(e){console.error("Error al registrar actualizaci\xf3n:",e)}}async function p(e,t){try{let r=e.headers.authorization;if(!r||!r.startsWith("Bearer "))return t.status(401).json({error:"No autorizado"});(0,o.fH)("Iniciando actualizaci\xf3n de predicciones...");let a=await c(20);(0,o.fH)(`Se procesar\xe1n predicciones para ${a.length} partidos`);let i=0,s=0;for(let e of a)try{(0,o.fH)(`Obteniendo predicciones para partido ID ${e.id} (${e.name})...`),i>0&&await new Promise(e=>setTimeout(e,1e3));let t=await (0,n.iL)(e.id),r=await d(e.id,t);(0,o.SW)(`Procesadas ${r} predicciones para partido ${e.id}`),i+=r}catch(t){(0,o.vV)(`Error procesando predicciones para partido ${e.id}:`,t),s++}return await u("predictions","batch_update",0===s?"success":"partial_success",i),t.status(200).json({success:!0,totalProcessed:i,errors:s,message:`Predicciones actualizadas: ${i} (Errores: ${s})`})}catch(e){return(0,o.vV)("Error en la actualizaci\xf3n de predicciones:",e),await u("predictions","batch_update","error",0,e.message),t.status(500).json({success:!1,error:e.message})}}a()}catch(e){a(e)}})},7724:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{config:()=>u,default:()=>d,routeModule:()=>p});var i=r(3480),n=r(8667),o=r(6435),s=r(7e3),c=e([s]);s=(c.then?(await c)():c)[0];let d=(0,o.M)(s,"default"),u=(0,o.M)(s,"config"),p=new i.PagesAPIRouteModule({definition:{kind:n.A.PAGES_API,page:"/api/cron/update-predictions",pathname:"/api/cron/update-predictions",bundlePath:"",filename:""},userland:s});a()}catch(e){a(e)}})},8667:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return r}});var r=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},9485:(e,t,r)=>{function a(e){console.log(`[INFO] [${new Date().toISOString()}] ${e}`)}function i(e,t){console.error(`[ERROR] [${new Date().toISOString()}] ${e}`,t)}function n(e){console.log(`[SUCCESS] [${new Date().toISOString()}] ${e}`)}r.d(t,{SW:()=>n,fH:()=>a,vV:()=>i})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=7724);module.exports=r})();