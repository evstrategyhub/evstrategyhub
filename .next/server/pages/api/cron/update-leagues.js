"use strict";(()=>{var e={};e.id=752,e.ids=[752],e.modules={132:(e,t,a)=>{a.a(e,async(e,n)=>{try{a.r(t),a.d(t,{default:()=>l});var r=a(3939),i=a(6556),o=a(9485),s=e([i]);i=(s.then?(await s)():s)[0];let d=(0,r.createClient)("https://nxhvjyfvdirhplgfpdkm.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im54aHZqeWZ2ZGlyaHBsZ2ZwZGttIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc0MDkzNzI1OCwiZXhwIjoyMDU2NTEzMjU4fQ.tflcdU-SgN-ODFXuimdEfAdvDDlvMoRNCqWZirYCj9Y");async function u(e){if(!e||!e.data||!Array.isArray(e.data))return 0;let t=e.data.map(e=>({id:e.id,name:e.name,country_id:e.country&&e.country.id?e.country.id:null,country_name:e.country&&e.country.name?e.country.name:null,logo_path:e.image_path||null,is_active:e.active||!0,type:e.type||null}));if(0===t.length)return 0;let{error:a}=await d.from("leagues").upsert(t,{onConflict:"id"});if(a)throw Error(`Error al almacenar ligas: ${a.message}`);return t.length}async function c(e,t,a,n=0,r=null){try{await d.from("update_logs").insert({entity_type:e,operation_type:t,status:a,records_affected:n,error_message:r,created_at:new Date().toISOString()})}catch(e){console.error("Error al registrar actualizaci\xf3n:",e)}}async function l(e,t){try{let a=e.headers.authorization;if(!a||!a.startsWith("Bearer "))return t.status(401).json({error:"No autorizado"});(0,o.fH)("Iniciando actualizaci\xf3n de ligas...");let n=0,r=1,s=!0;for(;s&&r<=5;){(0,o.fH)(`Obteniendo ligas - p\xe1gina ${r}...`),r>1&&await new Promise(e=>setTimeout(e,1500));let e=await (0,i.bE)(r),t=await u(e);n+=t,(0,o.SW)(`Procesadas ${t} ligas de la p\xe1gina ${r}`),e.meta&&e.meta.pagination?(s=r<e.meta.pagination.total_pages,r++):s=!1}return await c("leagues","full_update","success",n),t.status(200).json({success:!0,totalProcessed:n,message:`Ligas actualizadas: ${n}`})}catch(e){return(0,o.vV)("Error en la actualizaci\xf3n de ligas:",e),await c("leagues","full_update","error",0,e.message),t.status(500).json({success:!1,error:e.message})}}n()}catch(e){n(e)}})},3480:(e,t,a)=>{e.exports=a(5600)},3939:e=>{e.exports=require("@supabase/supabase-js")},5035:e=>{e.exports=import("node-fetch")},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6435:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,a){return a in t?t[a]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,a)):"function"==typeof t&&"default"===a?t:void 0}}})},6556:(e,t,a)=>{a.a(e,async(e,n)=>{try{a.d(t,{At:()=>s,ZN:()=>l,bE:()=>d,iL:()=>u,wK:()=>c});var r=a(5035),i=e([r]);async function o(e,t={}){let a=`https://api.sportmonks.com/v3/football/${e}`,n=Object.keys(t).map(e=>`${encodeURIComponent(e)}=${encodeURIComponent(t[e])}`).join("&"),i=n?`${a}?${n}`:a;try{let e=await (0,r.default)(i,{headers:{Authorization:"OFni7bARihvquALzUS9p2PqhZHgy2t2DWHjgFperwEwxwxSm5DD5doL1gXEj"}});if(!e.ok)throw Error(`Error en la respuesta de la API: ${e.status} ${e.statusText}`);return await e.json()}catch(t){throw console.error(`Error al obtener datos de ${e}:`,t),t}}function s(e,t){return o(`fixtures/between/${e}/${t}`)}function u(e){return o(`fixtures/${e}`,{include:"predictions"})}function c(e){return o(`fixtures/${e}`,{include:"odds"})}function l(e=1){return o("teams",{page:e})}function d(e=1){return o("leagues",{include:"country",page:e})}r=(i.then?(await i)():i)[0],n()}catch(e){n(e)}})},7856:(e,t,a)=>{a.a(e,async(e,n)=>{try{a.r(t),a.d(t,{config:()=>l,default:()=>c,routeModule:()=>d});var r=a(3480),i=a(8667),o=a(6435),s=a(132),u=e([s]);s=(u.then?(await u)():u)[0];let c=(0,o.M)(s,"default"),l=(0,o.M)(s,"config"),d=new r.PagesAPIRouteModule({definition:{kind:i.A.PAGES_API,page:"/api/cron/update-leagues",pathname:"/api/cron/update-leagues",bundlePath:"",filename:""},userland:s});n()}catch(e){n(e)}})},8667:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return a}});var a=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},9485:(e,t,a)=>{function n(e){console.log(`[INFO] [${new Date().toISOString()}] ${e}`)}function r(e,t){console.error(`[ERROR] [${new Date().toISOString()}] ${e}`,t)}function i(e){console.log(`[SUCCESS] [${new Date().toISOString()}] ${e}`)}a.d(t,{SW:()=>i,fH:()=>n,vV:()=>r})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var a=t(t.s=7856);module.exports=a})();