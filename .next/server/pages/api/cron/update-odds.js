"use strict";(()=>{var e={};e.id=884,e.ids=[884],e.modules={2078:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{config:()=>u,default:()=>c,routeModule:()=>l});var n=r(3480),o=r(8667),i=r(6435),s=r(3792),d=e([s]);s=(d.then?(await d)():d)[0];let c=(0,i.M)(s,"default"),u=(0,i.M)(s,"config"),l=new n.PagesAPIRouteModule({definition:{kind:o.A.PAGES_API,page:"/api/cron/update-odds",pathname:"/api/cron/update-odds",bundlePath:"",filename:""},userland:s});a()}catch(e){a(e)}})},3480:(e,t,r)=>{e.exports=r(5600)},3792:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{default:()=>l});var n=r(3939),o=r(6556),i=r(9485),s=e([o]);o=(s.then?(await s)():s)[0];let p=(0,n.createClient)("https://nxhvjyfvdirhplgfpdkm.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im54aHZqeWZ2ZGlyaHBsZ2ZwZGttIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc0MDkzNzI1OCwiZXhwIjoyMDU2NTEzMjU4fQ.tflcdU-SgN-ODFXuimdEfAdvDDlvMoRNCqWZirYCj9Y"),f=[2,9,20,26,28,29,35,39],m=[1,14,57,29,80,17,46,40,101,36,22,37];async function d(e=10){let t=new Date,r=Math.floor(t.getTime()/1e3),{data:a,error:n}=await p.from("fixtures").select("id, name").gt("starting_at_timestamp",r).eq("state_id",1).eq("has_odds",!0).order("starting_at_timestamp",{ascending:!0}).limit(e);if(n)throw Error(`Error al obtener fixtures: ${n.message}`);return a||[]}async function c(e,t){if(!t||0===t.length)return 0;let r=t.map(t=>({id:t.id,fixture_id:e,bookmaker_id:t.bookmaker_id,market_id:t.market_id,label:t.label,value:t.value,probability:t.probability,market_description:t.market_description,total:t.total||null,handicap:t.handicap||null})),{error:a}=await p.from("odds").upsert(r,{onConflict:"id"});if(a)throw Error(`Error al almacenar odds: ${a.message}`);return r.length}async function u(e,t,r,a=0,n=null){try{await p.from("update_logs").insert({entity_type:e,operation_type:t,status:r,records_affected:a,error_message:n,created_at:new Date().toISOString()})}catch(e){console.error("Error al registrar actualizaci\xf3n:",e)}}async function l(e,t){try{let r=e.headers.authorization;if(!r||!r.startsWith("Bearer "))return t.status(401).json({error:"No autorizado"});(0,i.fH)("Iniciando actualizaci\xf3n de odds...");let a=await d(10);(0,i.fH)(`Se procesar\xe1n odds para ${a.length} partidos`);let n=0,s=0;for(let e of a)try{(0,i.fH)(`Obteniendo odds para partido ID ${e.id} (${e.name})...`),n>0&&await new Promise(e=>setTimeout(e,1500));let t=await (0,o.wK)(e.id),r=function(e,t,r){return e&&e.data&&e.data.odds?e.data.odds.filter(e=>t.includes(e.bookmaker_id)&&r.includes(e.market_id)):[]}(t,f,m),a=await c(e.id,r);(0,i.SW)(`Procesadas ${a} odds para partido ${e.id}`),n+=a}catch(t){(0,i.vV)(`Error procesando odds para partido ${e.id}:`,t),s++}return await u("odds","batch_update",0===s?"success":"partial_success",n),t.status(200).json({success:!0,totalProcessed:n,errors:s,message:`Odds actualizadas: ${n} (Errores: ${s})`})}catch(e){return(0,i.vV)("Error en la actualizaci\xf3n de odds:",e),await u("odds","batch_update","error",0,e.message),t.status(500).json({success:!1,error:e.message})}}a()}catch(e){a(e)}})},3939:e=>{e.exports=require("@supabase/supabase-js")},5035:e=>{e.exports=import("node-fetch")},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6435:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},6556:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.d(t,{At:()=>s,ZN:()=>u,bE:()=>l,iL:()=>d,wK:()=>c});var n=r(5035),o=e([n]);async function i(e,t={}){let r=`https://api.sportmonks.com/v3/football/${e}`,a=Object.keys(t).map(e=>`${encodeURIComponent(e)}=${encodeURIComponent(t[e])}`).join("&"),o=a?`${r}?${a}`:r;try{let e=await (0,n.default)(o,{headers:{Authorization:"OFni7bARihvquALzUS9p2PqhZHgy2t2DWHjgFperwEwxwxSm5DD5doL1gXEj"}});if(!e.ok)throw Error(`Error en la respuesta de la API: ${e.status} ${e.statusText}`);return await e.json()}catch(t){throw console.error(`Error al obtener datos de ${e}:`,t),t}}function s(e,t){return i(`fixtures/between/${e}/${t}`)}function d(e){return i(`fixtures/${e}`,{include:"predictions"})}function c(e){return i(`fixtures/${e}`,{include:"odds"})}function u(e=1){return i("teams",{page:e})}function l(e=1){return i("leagues",{include:"country",page:e})}n=(o.then?(await o)():o)[0],a()}catch(e){a(e)}})},8667:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return r}});var r=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},9485:(e,t,r)=>{function a(e){console.log(`[INFO] [${new Date().toISOString()}] ${e}`)}function n(e,t){console.error(`[ERROR] [${new Date().toISOString()}] ${e}`,t)}function o(e){console.log(`[SUCCESS] [${new Date().toISOString()}] ${e}`)}r.d(t,{SW:()=>o,fH:()=>a,vV:()=>n})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=2078);module.exports=r})();