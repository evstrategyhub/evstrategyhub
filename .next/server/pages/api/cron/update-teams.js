"use strict";(()=>{var e={};e.id=216,e.ids=[216],e.modules={3480:(e,t,a)=>{e.exports=a(5600)},3939:e=>{e.exports=require("@supabase/supabase-js")},5035:e=>{e.exports=import("node-fetch")},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6435:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,a){return a in t?t[a]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,a)):"function"==typeof t&&"default"===a?t:void 0}}})},6556:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{At:()=>s,ZN:()=>l,bE:()=>d,iL:()=>u,wK:()=>c});var n=a(5035),o=e([n]);async function i(e,t={}){let a=`https://api.sportmonks.com/v3/football/${e}`,r=Object.keys(t).map(e=>`${encodeURIComponent(e)}=${encodeURIComponent(t[e])}`).join("&"),o=r?`${a}?${r}`:a;try{let e=await (0,n.default)(o,{headers:{Authorization:"OFni7bARihvquALzUS9p2PqhZHgy2t2DWHjgFperwEwxwxSm5DD5doL1gXEj"}});if(!e.ok)throw Error(`Error en la respuesta de la API: ${e.status} ${e.statusText}`);return await e.json()}catch(t){throw console.error(`Error al obtener datos de ${e}:`,t),t}}function s(e,t){return i(`fixtures/between/${e}/${t}`)}function u(e){return i(`fixtures/${e}`,{include:"predictions"})}function c(e){return i(`fixtures/${e}`,{include:"odds"})}function l(e=1){return i("teams",{page:e})}function d(e=1){return i("leagues",{include:"country",page:e})}n=(o.then?(await o)():o)[0],r()}catch(e){r(e)}})},8667:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return a}});var a=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},8820:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{default:()=>l});var n=a(3939),o=a(6556),i=a(9485),s=e([o]);o=(s.then?(await s)():s)[0];let d=(0,n.createClient)("https://nxhvjyfvdirhplgfpdkm.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im54aHZqeWZ2ZGlyaHBsZ2ZwZGttIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc0MDkzNzI1OCwiZXhwIjoyMDU2NTEzMjU4fQ.tflcdU-SgN-ODFXuimdEfAdvDDlvMoRNCqWZirYCj9Y");async function u(e){if(!e||!e.data||!Array.isArray(e.data))return 0;let t=e.data.map(e=>({id:e.id,name:e.name,short_code:e.short_code||null,country_id:e.country_id||null,logo_path:e.image_path||null,venue_id:e.venue_id||null,is_active:!0}));if(0===t.length)return 0;let{error:a}=await d.from("teams").upsert(t,{onConflict:"id"});if(a)throw Error(`Error al almacenar equipos: ${a.message}`);return t.length}async function c(e,t,a,r=0,n=null){try{await d.from("update_logs").insert({entity_type:e,operation_type:t,status:a,records_affected:r,error_message:n,created_at:new Date().toISOString()})}catch(e){console.error("Error al registrar actualizaci\xf3n:",e)}}async function l(e,t){try{let a=e.headers.authorization;if(!a||!a.startsWith("Bearer "))return t.status(401).json({error:"No autorizado"});(0,i.fH)("Iniciando actualizaci\xf3n de equipos...");let r=0,n=1,s=!0;for(;s&&n<=10;){(0,i.fH)(`Obteniendo equipos - p\xe1gina ${n}...`),n>1&&await new Promise(e=>setTimeout(e,1500));let e=await (0,o.ZN)(n),t=await u(e);r+=t,(0,i.SW)(`Procesados ${t} equipos de la p\xe1gina ${n}`),e.meta&&e.meta.pagination?(s=n<e.meta.pagination.total_pages,n++):s=!1}return await c("teams","full_update","success",r),t.status(200).json({success:!0,totalProcessed:r,message:`Equipos actualizados: ${r}`})}catch(e){return(0,i.vV)("Error en la actualizaci\xf3n de equipos:",e),await c("teams","full_update","error",0,e.message),t.status(500).json({success:!1,error:e.message})}}r()}catch(e){r(e)}})},9485:(e,t,a)=>{function r(e){console.log(`[INFO] [${new Date().toISOString()}] ${e}`)}function n(e,t){console.error(`[ERROR] [${new Date().toISOString()}] ${e}`,t)}function o(e){console.log(`[SUCCESS] [${new Date().toISOString()}] ${e}`)}a.d(t,{SW:()=>o,fH:()=>r,vV:()=>n})},9976:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{config:()=>l,default:()=>c,routeModule:()=>d});var n=a(3480),o=a(8667),i=a(6435),s=a(8820),u=e([s]);s=(u.then?(await u)():u)[0];let c=(0,i.M)(s,"default"),l=(0,i.M)(s,"config"),d=new n.PagesAPIRouteModule({definition:{kind:o.A.PAGES_API,page:"/api/cron/update-teams",pathname:"/api/cron/update-teams",bundlePath:"",filename:""},userland:s});r()}catch(e){r(e)}})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var a=t(t.s=9976);module.exports=a})();